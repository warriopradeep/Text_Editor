/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package editor;

import java.awt.Image;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.ArrayDeque;
import java.util.Deque;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.swing.ImageIcon;
import javax.swing.JFileChooser;

/**
 *
 * @author pradeep s
 */
public class TextEditor extends javax.swing.JFrame {

    /**
     * Creates new form TextEditor
     */
    public TextEditor() {
        initComponents();
        setTitle("Text Editor");
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">
    private void initComponents() {

        fileChooser = new javax.swing.JFileChooser();
        buttonPanel = new javax.swing.JPanel();
        openButton = new javax.swing.JButton();
        saveButton = new javax.swing.JButton();
        searchField = new javax.swing.JTextField();
        startSearch = new javax.swing.JButton();
        prevButton = new javax.swing.JButton();
        nextButton = new javax.swing.JButton();
        regexCheck = new javax.swing.JCheckBox();
        jScrollPane1 = new javax.swing.JScrollPane();
        textArea = new javax.swing.JTextArea();
        jMenuBar1 = new javax.swing.JMenuBar();
        fileMenu = new javax.swing.JMenu();
        openMenu = new javax.swing.JMenuItem();
        saveMenu = new javax.swing.JMenuItem();
        jSeparator1 = new javax.swing.JPopupMenu.Separator();
        exitMenu = new javax.swing.JMenuItem();
        searchMenu = new javax.swing.JMenu();
        startSearchMenu = new javax.swing.JMenuItem();
        previousMenu = new javax.swing.JMenuItem();
        nextMenu = new javax.swing.JMenuItem();
        useRegMenu = new javax.swing.JMenuItem();

        fileChooser.setName("FileChooser"); // NOI18N
        add(fileChooser);

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setMinimumSize(new java.awt.Dimension(680, 450));
        setPreferredSize(new java.awt.Dimension(650, 450));

        buttonPanel.setMaximumSize(new java.awt.Dimension(650, 30));
        buttonPanel.setMinimumSize(new java.awt.Dimension(650, 30));
        buttonPanel.setName(""); // NOI18N
        buttonPanel.setPreferredSize(new java.awt.Dimension(650, 30));

        openButton.setText("Open");
        openButton.setMaximumSize(new java.awt.Dimension(40, 40));
        openButton.setMinimumSize(new java.awt.Dimension(40, 23));
        openButton.setName("OpenButton"); // NOI18N
        openButton.setPreferredSize(new java.awt.Dimension(40, 23));
        openButton.addActionListener(evt -> openButtonActionPerformed(evt));

        saveButton.setText("Save");
        saveButton.setMaximumSize(new java.awt.Dimension(40, 23));
        saveButton.setMinimumSize(new java.awt.Dimension(40, 23));
        saveButton.setName("SaveButton"); // NOI18N
        saveButton.setPreferredSize(new java.awt.Dimension(40, 23));
        saveButton.addActionListener(evt -> saveButtonActionPerformed(evt));

        searchField.setMinimumSize(new java.awt.Dimension(60, 25));
        searchField.setName("SearchField"); // NOI18N
        searchField.setPreferredSize(new java.awt.Dimension(60, 25));

        startSearch.setText("Start");
        startSearch.setMaximumSize(new java.awt.Dimension(40, 23));
        startSearch.setMinimumSize(new java.awt.Dimension(40, 23));
        startSearch.setName("StartSearchButton"); // NOI18N
        startSearch.setPreferredSize(new java.awt.Dimension(40, 23));
        startSearch.addActionListener(evt -> startSearchActionPerformed(evt));

        prevButton.setText("Prev");
        prevButton.setMaximumSize(new java.awt.Dimension(40, 23));
        prevButton.setMinimumSize(new java.awt.Dimension(40, 23));
        prevButton.setName("PreviousMatchButton"); // NOI18N
        prevButton.setPreferredSize(new java.awt.Dimension(40, 23));
        prevButton.addActionListener(evt -> prevButtonActionPerformed(evt));

        nextButton.setText("Next");
        nextButton.setMaximumSize(new java.awt.Dimension(40, 23));
        nextButton.setMinimumSize(new java.awt.Dimension(40, 23));
        nextButton.setName("NextMatchButton"); // NOI18N
        nextButton.setPreferredSize(new java.awt.Dimension(40, 23));
        nextButton.addActionListener(evt -> nextButtonActionPerformed(evt));

        regexCheck.setText("Use Regex");
        regexCheck.setMaximumSize(new java.awt.Dimension(40, 23));
        regexCheck.setMinimumSize(new java.awt.Dimension(40, 23));
        regexCheck.setName("UseRegExCheckbox"); // NOI18N
        regexCheck.setPreferredSize(new java.awt.Dimension(40, 23));
        regexCheck.addActionListener(evt -> regexCheckActionPerformed(evt));

        javax.swing.GroupLayout buttonPanelLayout = new javax.swing.GroupLayout(buttonPanel);
        buttonPanel.setLayout(buttonPanelLayout);
        buttonPanelLayout.setHorizontalGroup(
                buttonPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(buttonPanelLayout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(openButton, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(saveButton, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(searchField, javax.swing.GroupLayout.PREFERRED_SIZE, 149, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(startSearch, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(prevButton, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(nextButton, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(regexCheck, javax.swing.GroupLayout.PREFERRED_SIZE, 81, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        buttonPanelLayout.setVerticalGroup(
                buttonPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, buttonPanelLayout.createSequentialGroup()
                                .addGap(7, 7, 7)
                                .addGroup(buttonPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(saveButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(openButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(searchField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(startSearch, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(nextButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(regexCheck, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(prevButton, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        buttonPanelLayout.linkSize(javax.swing.SwingConstants.VERTICAL, new java.awt.Component[] {nextButton, openButton, prevButton, regexCheck, saveButton, searchField, startSearch});

        jScrollPane1.setName("ScrollPane"); // NOI18N

        textArea.setColumns(20);
        textArea.setRows(5);
        textArea.setName("TextArea"); // NOI18N
        jScrollPane1.setViewportView(textArea);

        jMenuBar1.setMaximumSize(new java.awt.Dimension(650, 25));
        jMenuBar1.setMinimumSize(new java.awt.Dimension(650, 25));
        jMenuBar1.setPreferredSize(new java.awt.Dimension(650, 25));

        fileMenu.setText("File");
        fileMenu.setName("MenuFile"); // NOI18N

        openMenu.setText("Open");
        openMenu.setName("MenuOpen"); // NOI18N
        openMenu.addActionListener(evt -> openButtonActionPerformed(evt));
        fileMenu.add(openMenu);

        saveMenu.setText("Save");
        saveMenu.setName("MenuSave"); // NOI18N
        saveMenu.addActionListener(evt -> saveButtonActionPerformed(evt));
        fileMenu.add(saveMenu);
        fileMenu.add(jSeparator1);

        exitMenu.setText("Exit");
        exitMenu.setName("MenuExit"); // NOI18N
        exitMenu.addActionListener(evt -> System.exit(0));
        fileMenu.add(exitMenu);

        jMenuBar1.add(fileMenu);

        searchMenu.setText("Search");
        searchMenu.setName("MenuSearch"); // NOI18N

        startSearchMenu.setText("Start Search");
        startSearchMenu.setName("MenuStartSearch"); // NOI18N
        startSearchMenu.addActionListener(evt -> startSearchActionPerformed(evt));
        searchMenu.add(startSearchMenu);

        previousMenu.setText("Previous Match");
        previousMenu.setName("MenuPreviousMatch"); // NOI18N
        previousMenu.addActionListener(evt -> prevButtonActionPerformed(evt));
        searchMenu.add(previousMenu);

        nextMenu.setText("Next Match");
        nextMenu.setName("MenuNextMatch"); // NOI18N
        nextMenu.addActionListener(evt -> nextButtonActionPerformed(evt));
        searchMenu.add(nextMenu);

        useRegMenu.setText("Use Regular Expression");
        useRegMenu.setName("MenuUseRegExp"); // NOI18N
        useRegMenu.addActionListener(evt -> regexCheckActionPerformed(evt));
        searchMenu.add(useRegMenu);

        jMenuBar1.add(searchMenu);

        setJMenuBar(jMenuBar1);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(buttonPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jScrollPane1)
        );
        layout.setVerticalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                                .addGap(7, 7, 7)
                                .addComponent(buttonPanel, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 366, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        pack();
    }// </editor-fold>

    private void openButtonActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
        int returnValue = fileChooser.showOpenDialog(null);

        if (returnValue == JFileChooser.APPROVE_OPTION) {
            currentFile = fileChooser.getSelectedFile();
            System.out.println("Current File Chosen: " + currentFile.getAbsolutePath());
            fileOpened = true;
        }

        textArea.setText("");

        try {
            String text = Files.readString(Paths.get(currentFile.getAbsolutePath()));
            textArea.setText(text);
        } catch (Exception e) {
            System.out.println("No such file");
        }

    }

    private void saveButtonActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
        try {
            int returnValue = fileChooser.showSaveDialog(null);

            if (returnValue == JFileChooser.APPROVE_OPTION) {
                currentFile = fileChooser.getSelectedFile();
                writer = new FileWriter(currentFile);
                String toWrite = textArea.getText();
                writer.write(toWrite);
                writer.flush();
                writer.close();
                System.out.println("Current file saved to: " + currentFile.getAbsolutePath());
                fileOpened = true;
            }
        } catch (IOException e) {
            System.out.println("Oops, file not found. File may have been deleted");
            e.printStackTrace();
        }


    }

    private void startSearchActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
        sText = searchField.getText().trim();

        System.out.println(sText);
        indexStack.clear();
        needle = 0;
        currIndex = 0;

        // function to find all the search term index in the textArea
        if (regex) {
            findRegexIndexes(sText);

            currIndex = indx[needle]; // gets the first index of the search term
            int groupLength = groupList[needle].length();
            textArea.setCaretPosition(currIndex + groupLength);
            textArea.select(currIndex, currIndex + groupLength);
            textArea.grabFocus();
        } else {
            findIndexes(sText);

            currIndex = indx[needle]; // gets the first index of the search term

            textArea.setCaretPosition(currIndex + searchTermLength);
            textArea.select(currIndex, currIndex + searchTermLength);
            textArea.grabFocus();
        }


    }

    private void findIndexes(String sText) {
        searchTermLength = sText.length();
        currIndex = textArea.getText().indexOf(sText);

        while (currIndex != -1) {
            indexStack.addLast(currIndex);
            int nextIndex = currIndex + searchTermLength;
            currIndex = textArea.getText().indexOf(sText, nextIndex);
        }

        // initialize the list array having the indexes
        indx = new int[indexStack.size()];

        // copy the deque to the array
        int count = 0;
        for (Integer integer : indexStack) {
            indx[count++] = integer;
        }
    }

    private void findRegexIndexes(String sText) {
        Pattern p = Pattern.compile(sText);
        Matcher m = p.matcher(textArea.getText());
        int x = 0;

        while (m.find(x)) {
            indexStack.addLast(m.start());
            String curGroup = m.group();
            int groupLength = curGroup.length();
            System.out.println(curGroup);
            groupStack.addLast(curGroup);
            x = m.start() + groupLength;
        }

        groupList = new String[groupStack.size()];

        // copy deque to array
        int count = 0;
        for (String s : groupStack) {
            groupList[count++] = s;
        }

        indx = new int[indexStack.size()];

        // copy the deque to the array
        count = 0;
        for (Integer integer : indexStack) {
            indx[count++] = integer;
        }

    }

    private void prevButtonActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
        // check if the indexStack is at its last element

        if (needle == 0) {
            needle = indx.length - 1;
        } else {
            --needle;
        }

        currIndex = indx[needle];

        if (regex) {
            int groupLength = groupList[needle].length();
            textArea.setCaretPosition(currIndex + groupLength);
            textArea.select(currIndex, currIndex + groupLength);
            textArea.grabFocus();
        } else {
            textArea.setCaretPosition(currIndex + searchTermLength);
            textArea.select(currIndex, currIndex + searchTermLength);
            textArea.grabFocus();
        }
    }

    private void nextButtonActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
        if (needle == indx.length - 1) {
            needle = 0;
        } else {
            ++needle;
        }

        currIndex = indx[needle];

        if (regex) {
            int groupLength = groupList[needle].length();
            textArea.setCaretPosition(currIndex + groupLength);
            textArea.select(currIndex, currIndex + groupLength);
            textArea.grabFocus();

        } else {
            System.out.println("Next Index: " + currIndex);

            textArea.setCaretPosition(currIndex + searchTermLength);
            textArea.select(currIndex, currIndex + searchTermLength);
            textArea.grabFocus();
        }

    }

    private void regexCheckActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
        if (regex){
            regex = false;
            regexCheck.setSelected(false);
        } else {
            regex = true;
            regexCheck.setSelected(true);
        }
    }



    private void iconResize(ImageIcon x) {
        Image newImg = x.getImage().getScaledInstance(10, 10, java.awt.Image.SCALE_SMOOTH);
        x.setImage(newImg);
    }


    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(TextEditor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(TextEditor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(TextEditor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(TextEditor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new TextEditor().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify
    private javax.swing.JPanel buttonPanel;
    private javax.swing.JMenuItem exitMenu;
    private javax.swing.JFileChooser fileChooser;
    private javax.swing.JMenu fileMenu;
    private javax.swing.JMenuBar jMenuBar1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JPopupMenu.Separator jSeparator1;
    private javax.swing.JButton nextButton;
    private javax.swing.JMenuItem nextMenu;
    private javax.swing.JButton openButton;
    private javax.swing.JMenuItem openMenu;
    private javax.swing.JButton prevButton;
    private javax.swing.JMenuItem previousMenu;
    private javax.swing.JCheckBox regexCheck;
    private javax.swing.JButton saveButton;
    private javax.swing.JMenuItem saveMenu;
    private javax.swing.JTextField searchField;
    private javax.swing.JMenu searchMenu;
    private javax.swing.JButton startSearch;
    private javax.swing.JMenuItem startSearchMenu;
    private javax.swing.JTextArea textArea;
    private javax.swing.JMenuItem useRegMenu;
    // End of variables declaration

    // Icons
    ImageIcon saveIcon = new ImageIcon("C:\\Users\\pradeep shanbhogue\\IdeaProjects\\Text Editor1\\Text Editor\\task\\src\\editor\\save.png");
    ImageIcon openIcon = new ImageIcon("C:\\Users\\pradeep shanbhogue\\IdeaProjects\\Text Editor1\\Text Editor\\task\\src\\editor\\open.png");
    ImageIcon prevIcon = new ImageIcon("C:\\Users\\pradeep shanbhogue\\IdeaProjects\\Text Editor1\\Text Editor\\task\\src\\editor\\prev.png");
    ImageIcon nextIcon = new ImageIcon("C:\\Users\\pradeep shanbhogue\\IdeaProjects\\Text Editor1\\Text Editor\\task\\src\\editor\\next.png");
    ImageIcon searchIcon = new ImageIcon("C:\\Users\\pradeep shanbhogue\\IdeaProjects\\Text Editor1\\Text Editor\\task\\src\\editor\\search.png");

    // File variables
    private File file = null;
    private FileWriter writer;
    private String file_name; // hold the name of the file
    private File currentFile; // keep track of the current file
    private String path = "C:\\Users\\pradeep shanbhogue\\IdeaProjects\\Text Editor1\\Text Editor\\task";
    private boolean fileOpened = false;

    // Search variables
    int currIndex = 0;
    int searchTermLength = 0;
    String sText = "";
    boolean backAlreadyPressed = false;
    boolean regex = false;
    Deque<Integer> indexStack = new ArrayDeque<>();
    Deque<String> groupStack = new ArrayDeque<>();

    int[] indx;
    int needle = 0;

    String[] groupList;
}
